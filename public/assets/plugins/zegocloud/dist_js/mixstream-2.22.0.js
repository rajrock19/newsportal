!function(e,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var t=r();for(var o in t)("object"==typeof exports?exports:e)[o]=t[o]}}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";var e={5906:function(e,r,t){var o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var r,t=1,o=arguments.length;t<o;t++)for(var a in r=arguments[t])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e},o.apply(this,arguments)};Object.defineProperty(r,"__esModule",{value:!0}),r.streamHandler=r.zegoWebRTC=r.TRACER_LEVEL=void 0;var a,s=t(817),n=t(6145),i="2.22.0",g=1e4,u={};!function(e){e[e.I=0]="I",e[e.H=10]="H",e[e.M=100]="M",e[e.L=1e3]="L"}(a=r.TRACER_LEVEL||(r.TRACER_LEVEL={}));var d={code:1005027,message:"mix stream input parameters are wrong"};function m(e,r){var t,o,a,n,i="",u=s.errorCodeList;return r.errorCode<2e9&&r.errorCode>1e9?(a={1:"MIXER_START_REQUEST_ERROR",2:"MIXER_START_REQUEST_ERROR",3:"MIXER_AUTHENTICATION_FAILED",150:"MIXER_INPUT_STREAM_NOT_EXISTS",151:"MIXER_START_REQUEST_ERROR",152:"MIXER_STOP_REQUEST_ERROR",153:"MIXER_INPUT_PARAMETERS_ERROR",154:"MIXER_EXCEED_MAX_OUTPUT_COUNT",155:"MIXER_INPUT_PARAMETERS_ERROR",156:"MIXER_VIDEO_CONFIG_INVALID",157:"MIXER_NO_SERVICES",158:"MIXER_EXCEED_MAX_INPUT_COUNT",159:"MIXER_START_REQUEST_ERROR",160:"MIXER_NOT_OWNER_STOPMIXER",170:"MIXER_WATERMARK_PARAMETERS_ERROR",171:"MIXER_WATERMARK_NULL",175:"MIXER_REPEAT_INPUT",190:"MIXER_START_REQUEST_ERROR"},n="MIXER_INNER_ERROR",(o=r.errorCode-g)>1e9&&a[o-1e9]&&(n=a[o-1e9]),t=u[i=n]):r.errorCode<1e6&&(t=e.decodeServerError(r.errorCode,r.extendedData),i=e.getLiveRoomError(r.errorCode,this.stateCenter.useNetAgent)),{reportErr:t,actualError:u[i]}}r.zegoWebRTC={startMixerTask:function(e){var r=this;return new Promise((function(t,o){var s=r.stateCenter.reporter.createSpan(a.H,{key:n.ZegoRTCLogEvent.kZMInitSetting.event},{key:n.ZegoRTCLogEvent.kZegoTaskMixStart.event,par:e.taskID},n.ZegoRTCLogEvent.kZegoTaskMixStart.event,!0),i={errorCode:d.code,extendedData:d.message};if(!!(null==e?void 0:e.inputList.find((function(e){return null==e.streamID&&(i.extendedData=i.extendedData+". streamID should be of string type",!0)}))))return r.stateCenter.reporter.setError(s,d),void o(i);e.outputConfig&&e.outputConfig.outputFps&&(e.outputConfig.outputFPS=e.outputConfig.outputFps);var g=function(t){var a=m(r.stateCenter,t),i=a.reportErr,g=a.actualError;1005026===t.errorCode&&s.setAttributes({stop_reason:"UnmatchStreamId"}),r.stateCenter.reporter.setError(s,i||t),r.stateCenter.reporter.spanEnd({key:n.ZegoRTCLogEvent.kZegoTaskMixStart.event,par:e.taskID}),g&&(t.errorCode=null==g?void 0:g.code,t.extendedData=(null==g?void 0:g.message)||""),o(t)},u=r.stateCenter.roomList[0];u?u.streamHandler.updateMixStream(e,(function(o){r.stateCenter.reporter.spanEnd({key:n.ZegoRTCLogEvent.kZegoTaskMixStart.event,par:e.taskID}),t(o)}),g):g({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kNoLoginError.message})}))},setMixerTaskConfig:function(e){var r=this;return new Promise((function(t,o){var s=r.stateCenter.reporter.createSpan(a.H,{key:n.ZegoRTCLogEvent.kZMInitSetting.event},{key:""},n.ZegoRTCLogEvent.kZegoTaskMixConfig.event);s.setAttributes({mix_params:n.ZegoRTCLogEvent.kZegoTaskMixConfig.mix_params(e)});var i=r.stateCenter.roomList[0];i?i.streamHandler.setMixerTaskConfig(e).then((function(e){s.end(),t(e)})).catch((function(e){r.stateCenter.reporter.setError(s,e),o(e)})):o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kNoLoginError.message})}))},stopMixerTask:function(e){var r=this;return new Promise((function(t,o){var s=r.stateCenter.reporter.createSpan(a.H,{key:n.ZegoRTCLogEvent.kZMInitSetting.event},{key:""},n.ZegoRTCLogEvent.kZegoTaskMixStop.event);if(!e||"string"!=typeof e||e.length>256||!r.stateCenter.checkIllegalCharacters(e))return r.logger.error("zb.rh.lg taskID must be string less 256"),r.stateCenter.reporter.setError(s,n.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError," param taskID error"),void o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStop.error.kParamError.message+" param taskID error"});s.setAttributes({mix_task_id:e});var i=function(e){var t=m(r.stateCenter,e),a=t.actualError;r.stateCenter.reporter.setError(s,t.reportErr||e),a&&(e.errorCode=null==a?void 0:a.code,e.extendedData=(null==a?void 0:a.message)||""),o(e)},g=r.stateCenter.roomList[0];g?g.streamHandler.stopMixStream(e,(function(e){s.end(),t(e)}),i):i({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStop.error.kNoLoginError.message})}))}},r.streamHandler={setMixerTaskConfig:function(e){var r=this;return new Promise((function(t,o){var a,s={},i={};if(e&&e.videoCodec){var g=e.videoCodec.toLowerCase();if(-1==["vp8","h264"].indexOf(g))return r.logger.error("zb.sh.ums param videoCode error"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kVideoConfigInvalidError.message}),!1;s.videoCodec=g,i.video_codec=g}if(e.backgroundColor){if(!r.stateCenter.checkInteger(e.backgroundColor))return r.logger.error("zb.sh.ums param backgroundColor must be integer number"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;s.backgroundColor=e.backgroundColor,i.background_color=e.backgroundColor}if(e.backgroundImage){if("string"!=typeof e.backgroundImage)return r.logger.error("zb.sh.ums param outputBgImage error"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;if(!e.backgroundImage.startsWith("preset-id://")||!e.backgroundImage.endsWith(".jpg")&&!e.backgroundImage.endsWith(".png"))return r.logger.error("zb.sh.ums illegal input background image URL"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kBackgroundImageUrlInvalidError.message}),!1;s.backgroundImage=e.backgroundImage,i.background_image=e.backgroundImage}if(e.waterMark&&(s.waterMark=e.waterMark,i.water_mark=e.waterMark),e&&e.userData){if(!(e.userData instanceof Uint8Array))return r.logger.error("zb.sh.ums param userData required Uint8Array"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;if(e.userData.byteLength>1e3)return r.logger.error("zb.sh.ums param userData should shorter than 1000"),o({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixConfig.error.kParamError.message}),!1;s.userData=e.userData}e.extraParams&&(s.extraParams||(s.extraParams=[]),(a=s.extraParams).push.apply(a,e.extraParams)),u=s,t({errorCode:0,extendedData:""})}))},stopMixStream:function(e,r,t,o,a){var u=this;this.logger.info("zb.sh.sms call");var d={id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:i};if("string"==typeof e&&(d.task_id=e),null!=o?d.stream_id=this.stateCenter.testEnvironment?"zegotest-"+this.stateCenter.appid+"-"+o:o:null!=a&&(d.mixurl=a),this.stateCenter.useNetAgent)this.sendBizChannelRequestV2({server:12,location:"/interface/command",cmd:"stop_mix"},d,(function(e){r&&r({errorCode:0,extendedData:""})}),(function(e,r,o,a){var i="";if(a)return a==s.errorCodeList.TIMEOUT&&(a=n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError),a.code&&20010===a.code&&(a=JSON.parse(JSON.stringify(s.errorCodeList.MIXER_NO_SERVICES))),void(t&&t(a,i));if(a=n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,200===e){if("number"==typeof r)return u.logger.debug("zb.sh.sms error: "+r),r+=1e9,void(t&&t({errorCode:u.stateCenter.getServerError(g+r).code,extendedData:i}));u.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(error));var d=n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError;t&&t({errorCode:d.code,extendedData:d.message})}else u.logger.error("zb.sh.sms "+(i="request mix server fail, error: "+e)),t&&t(a,i)}));else{var m={channel:"zeus",cmd:"stop_mix",req_body:JSON.stringify(d)};this.sendBizChannelRequest(m,(function(){r&&r({errorCode:0,extendedData:""})}),(function(e){if("number"==typeof e)t&&t({errorCode:u.stateCenter.getServerError(g+e).code,extendedData:""});else{u.logger.error("zb.sh.sms stop mix fail "+JSON.stringify(e));var r=void 0;r=e==s.errorCodeList.TIMEOUT?n.ZegoRTCLogEvent.kZegoTaskMixStop.error.kRequestError:n.ZegoRTCLogEvent.kZegoTaskMixStop.error.kInternalError,t&&t({errorCode:r.code,extendedData:r.message})}}))}return!0},updateMixStream:function(e,r,t){var a,d=this;this.logger.info("zb.sh.ums call");var m,l=[];if(!e.noTaskID&&!e.taskID)return this.logger.error("zb.sh.ums no taskId found"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDNullError.message}),!1;if(!e.noTaskID&&"string"!=typeof e.taskID)return this.logger.error("zb.rh.lg taskId must be string"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.noTaskID&&e.taskID.length>256)return this.logger.error("zb.sh.ums taskId is too long"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDToLongError.message}),!1;if(!e.noTaskID&&!this.stateCenter.checkIllegalCharacters(e.taskID))return this.logger.error("zb.sh.ums task ID contains illegal characters"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kTaskIDInvalidCharacterError.message}),!1;if(!e.inputList||0==e.inputList.length)return this.logger.error("zb.sh.ums input list wrong"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInputListNullError.message}),!1;e.inputList.forEach((function(e){"AUDIO"===e.contentType&&(!e.layout&&(e.layout={top:0,left:0,bottom:0,right:0}),e.layout.top=0,e.layout.left=0,e.layout.bottom=1,e.layout.right=1)}));for(var E=0;E<e.inputList.length;E++){var k=e.inputList[E],C={errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message};if("object"!=typeof k.layout)return this.logger.error("zb.sh.ums input layout must be object"),t(C),!1;if(!(this.stateCenter.checkInteger(k.layout.top,!1)&&this.stateCenter.checkInteger(k.layout.bottom,!1)&&this.stateCenter.checkInteger(k.layout.left,!1)&&this.stateCenter.checkInteger(k.layout.right,!1)))return this.logger.error("zb.sh.ums top、left、bottom、right must be integer number"),t(C),!1;if(void 0!==k.renderMode&&![0,1].includes(k.renderMode))return this.logger.error("zb.sh.ums render_mode is wrong"),t(C),!1}if(!e.outputList||0==e.outputList.length)return this.logger.error("zb.sh.ums no output list found"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputListNullError.message}),!1;if(e.outputList.some((function(e){return"string"==typeof e&&!d.stateCenter.isUrl(e)&&!d.stateCenter.checkIllegalCharacters(e)||"object"==typeof e&&e.target&&!d.stateCenter.isUrl(e.target)&&!d.stateCenter.checkIllegalCharacters(e.target)})))return this.logger.error("zb.sh.ums stream output target is incorrect"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;if(!((m=e.inputList.every((function(e){return"AUDIO"===e.contentType})))||e.outputConfig&&"object"==typeof e.outputConfig))return this.logger.error("zb.sh.ums no output config found"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputNoTargetError.message}),!1;if(m&&(e.outputConfig=o(o({},e.outputConfig||{}),{outputBitrate:.001,outputFPS:1,outputWidth:1,outputHeight:1})),!(m||e.outputConfig.outputBitrate&&this.stateCenter.checkInteger(e.outputConfig.outputBitrate)))return this.logger.error("zb.sh.ums bitrate param is required and must be integer number"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputFPS||!this.stateCenter.checkInteger(e.outputConfig.outputFPS))return this.logger.error("zb.sh.ums fps param is required and must be integer number"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputWidth||!this.stateCenter.checkInteger(e.outputConfig.outputWidth))return this.logger.error("zb.sh.ums width param is required and must be integer number"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(!e.outputConfig.outputHeight||!this.stateCenter.checkInteger(e.outputConfig.outputHeight))return this.logger.error("zb.sh.ums height param is required and must be integer number"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioCodecID&&!this.stateCenter.checkInteger(e.outputConfig.outputAudioCodecID,!1))return this.logger.error("zb.sh.ums AudioCodecID param must be integer number"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioBitrate&&!this.stateCenter.checkInteger(e.outputConfig.outputAudioBitrate))return this.logger.error("zb.sh.ums AudioBitrate param must be integer number"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;if(void 0!==e.outputConfig.outputAudioChannels&&!this.stateCenter.checkInteger(e.outputConfig.outputAudioChannels,!1))return this.logger.error("zb.sh.ums AudioChannels param must be integer number"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kParamError.message}),!1;var p=[];for(E=0;E<e.inputList.length;E++){var T=e.inputList[E],c=T.streamID;this.stateCenter.testEnvironment&&(c="zegotest-"+this.stateCenter.appid+"-"+T.streamID),p.push({stream_id:c,content_control:"AUDIO"===T.contentType?1:0,rect:{layer:E,top:T.layout.top,left:T.layout.left,bottom:T.layout.bottom,right:T.layout.right},render_mode:T.renderMode}),l.push({stream_id:c,content_control:"AUDIO"===T.contentType?1:0,top:T.layout.top,left:T.layout.left,bottom:T.layout.bottom,right:T.layout.right,render_mode:T.renderMode})}var R={},_=[],h=0;e.outputConfig.singleStreamPassThrough&&"boolean"==typeof e.outputConfig.singleStreamPassThrough&&(h=e.outputConfig.singleStreamPassThrough?1:0),R={task_id:e.taskID,id_name:this.stateCenter.idName,live_channel:this.roomID,appid:this.stateCenter.appid,version:i,bypass:h,timestamp:Math.ceil((new Date).getTime()/1e3)};var f=u;f&&(f.videoCodec&&(R.extra_params=[{key:"video_encode",value:f.videoCodec}]),f.backgroundColor&&(R.output_bg_color=f.backgroundColor),f.backgroundImage&&(R.output_bg_image=f.backgroundImage),f.waterMark&&(R.watermark=f.waterMark),f.userData&&(R.userdata=this.stateCenter.uint8arrayToBase64(f.userData)),f.extraParams&&(!R.extra_params&&(R.extra_params=[]),(a=R.extra_params).push.apply(a,f.extraParams))),R.MixInput=e.inputList.map((function(e,r){var t=e.streamID;return d.stateCenter.testEnvironment&&(t="zegotest-"+d.stateCenter.appid+"-"+e.streamID),{stream_id:t,content_control:"AUDIO"===e.contentType?1:0,rect:{layer:r,top:e.layout.top,left:e.layout.left,bottom:e.layout.bottom,right:e.layout.right},render_mode:e.renderMode}}));var I=[];R.MixOutput=e.outputList.map((function(r){var o={},a="";if("string"==typeof r)a=r;else{if("object"!=typeof r||!r.target)return d.logger.error("zb.sh.ums output target required"),t({errorCode:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.code,extendedData:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kOutputTargetInvalidError.message}),!1;a=r.target}return a.startsWith("rtmp://")||a.startsWith("https://")&&a.endsWith(".flv")||a.startsWith("https://")&&a.endsWith(".m3u8")?o.mixurl=a:o.stream_id=d.stateCenter.testEnvironment?"zegotest-"+d.stateCenter.appid+"-"+a:a,o.bitrate=1e3*e.outputConfig.outputBitrate,o.fps=e.outputConfig.outputFPS,o.width=e.outputConfig.outputWidth,o.height=e.outputConfig.outputHeight,e.outputConfig.outputAudioCodecID&&(o.audio_enc_id=e.outputConfig.outputAudioCodecID),"vp8"===f.videoCodec?o.audio_enc_id=3:"h264"===f.videoCodec&&(o.audio_enc_id=0),e.outputConfig.outputAudioBitrate&&(o.audio_bitrate=1e3*e.outputConfig.outputAudioBitrate),e.outputConfig.outputAudioChannels&&(o.audio_channel_cnt=e.outputConfig.outputAudioChannels),o.testenv=d.stateCenter.testEnvironment?1:0,I.push(o),_.push({target:o.mixurl||o.stream_id,is_url:!!o.mixurl+""}),o}));var v=e.outputConfig;this.stateCenter.reporter.spanSetAttributes({key:n.ZegoRTCLogEvent.kZegoTaskMixStart.event,par:e.taskID},{mix_stream_conf:n.ZegoRTCLogEvent.kZegoTaskMixStart.mix_stream_conf({fps:v.outputFPS,bitrate:v.outputBitrate,w:v.outputWidth,h:v.outputHeight,stream_cnt:l.length,mix_task_id:e.taskID,input_stream_list:l,output_target_list:_})}),this.logger.debug("zb.sh.ums send command");var L="zegotest-"+this.stateCenter.appid+"-";if(this.stateCenter.useNetAgent)this.sendBizChannelRequestV2({server:12,location:"/interface/command",cmd:"start_mix"},R,(function(e){var t=e.play.map((function(e){var r={rtmpURL:"",hlsURL:"",flvURL:""},t=e.stream_alias||"";return d.stateCenter.testEnvironment&&t&&t.startsWith(L)&&(t=t.slice(L.length)),r.streamID=t,e.rtmp_url&&e.rtmp_url.length>0&&(r.rtmpURL=e.rtmp_url),e.hls_url&&e.hls_url.length>0&&(r.hlsURL=e.hls_url),e.hdl_url&&e.hdl_url.length>0&&(r.flvURL=e.hdl_url),r}));r&&r({errorCode:0,extendedData:JSON.stringify({mixerOutputList:t})})}),(function(e,r,o,a){var i="";if(a)return a==s.errorCodeList.TIMEOUT&&(a=n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError),a.code&&20010===a.code&&(a=JSON.parse(JSON.stringify(s.errorCodeList.MIXER_NO_SERVICES))),void(t&&t(a,i));if(a=n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,200===e){if("number"==typeof r){if(d.logger.debug("zb.sh.ums error: "+r),1000000150==(r+=1e9)&&o){var u=o,m=(null==u?void 0:u.non_exist_streams.map((function(e){return d.stateCenter.testEnvironment&&e.startsWith(L)?e.slice(L.length):e})))||[];m.length>0&&(d.logger.debug("zb.sh.ums not exist streams: "+m),i=m.join(","))}return void(t&&t({errorCode:d.stateCenter.getServerError(g+r).code,extendedData:i}))}d.logger.debug("zb.sh.ums error code "+r);var l=n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError;t&&t({errorCode:l.code,extendedData:l.message})}else d.logger.error("zb.sh.ums "+(i="request mix server fail, error: "+e)),t&&t(a,i)}));else{var x={channel:"zeus",cmd:"start_mix",req_body:JSON.stringify(R)};this.sendBizChannelRequest(x,(function(e,o,a){if(d.logger.debug("zb.sh.ums receive message"),0!=a.length){for(var s=JSON.parse(a),n=[],i=0;i<s.play.length;i++){var g={rtmpURL:"",hlsURL:"",flvURL:""},u=s.play[i].stream_alias||"";d.stateCenter.testEnvironment&&u&&u.startsWith(L)&&(u=u.slice(L.length)),g.streamID=u,s.play[i].rtmp_url&&s.play[i].rtmp_url.length>0&&(g.rtmpURL=s.play[i].rtmp_url),s.play[i].hls_url&&s.play[i].hls_url.length>0&&(g.hlsURL=s.play[i].hls_url),s.play[i].hdl_url&&s.play[i].hdl_url.length>0&&(g.flvURL=s.play[i].hdl_url),n.push(g)}if(r)r({errorCode:0,extendedData:JSON.stringify({mixerOutputList:n})})}else t&&t({errorCode:d.stateCenter.getServerError(10001).code,extendedData:""})}),(function(e,r,o){if("number"==typeof e){d.logger.debug("zb.sh.ums error: "+e);var a=[];if(1000000150==e&&0!=o.length)for(var i=JSON.parse(o),u=0;u<i.non_exist_streams.length;u++){var m=i.non_exist_streams[u];d.stateCenter.testEnvironment&&m.startsWith(L)?a.push(m.slice(L.length)):a.push(m)}t&&t({errorCode:d.stateCenter.getServerError(g+e).code,extendedData:""})}else{d.logger.debug("zb.sh.ums error code "+e.code);var l=void 0;l=e==s.errorCodeList.TIMEOUT?n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kRequestError:n.ZegoRTCLogEvent.kZegoTaskMixStart.error.kInternalError,t&&t({errorCode:l.code,extendedData:l.message})}}))}return!0}}},817:function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.errorCodeList=void 0,r.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},INPUT_PARAM:{code:1100001,message:"input param error."},TIMEOUT:{code:1100002,message:"network timeout."},MIXER_NO_SERVICES:{code:1005e3,message:"no mix stream service"},MIXER_TASK_ID_NULL:{code:1005001,message:"mixer task is null"},MIXER_TASK_ID_TOO_LONG:{code:1005002,message:"task ID is too long"},MIXER_TASK_ID_INVALID_CHARACTER:{code:1005003,message:"task ID contains illegal characters"},MIXER_NO_OUTPUT_TARGET:{code:1005005,message:"task configuration does not specify output"},MIXER_OUTPUT_TARGET_INVALID:{code:1005006,message:"stream output target is incorrect"},MIXER_START_REQUEST_ERROR:{code:1005010,message:"start mixer task fail, possibly due to network reasons"},MIXER_STOP_REQUEST_ERROR:{code:1005011,message:"stop mixer task fail, possibly due to network reasons"},MIXER_NOT_OWNER_STOP_MIXER:{code:1005012,message:" maxed task must be stopped by the start user of the task"},MIXER_INPUTLIST_NULL:{code:1005020,message:"Mixed stream task input list is null"},MIXER_OUTPUTLIST_NULL:{code:1005021,message:"Mixed stream task output list is null"},MIXER_VIDEO_CONFIG_INVALID:{code:1005023,message:"invalid mixed stream task video configuration"},MIXER_EXCEED_MAX_INPUT_COUNT:{code:1005025,message:"more than the maximum number of input streams"},MIXER_INPUT_STREAM_NOT_EXISTS:{code:1005026,message:"Input stream does not exist"},MIXER_EXCEED_MAX_OUTPUT_COUNT:{code:1005030,message:"more than the maximum number of output streams"},MIXER_AUTHENTICATION_FAILED:{code:1005050,message:"mixed stream authentication failed"},MIXER_WATERMARK_NULL:{code:1005061,mag:"input watermark is null"},MIXER_WATERMARK_PARAMETERS_ERROR:{code:1005062,message:"input watermark parameter is wrong"},MIXER_WATERMARK_URL_INVALID:{code:1005063,message:"illegal input watermark URL"},MIXER_BACKGROUND_IMAGE_URL_INVALID:{code:1005067,message:"illegal input background image URL"},MIXER_REPEAT_INPUT:{code:1005099,message:"mix stream input repeat"},MIXER_INNER_ERROR:{code:1005099,message:"mixer internal error"}}},6145:function(e,r,t){Object.defineProperty(r,"__esModule",{value:!0}),r.ZegoRTCLogEvent=void 0;var o=t(817),a=function(e){return e};r.ZegoRTCLogEvent={kZMInitSetting:{event:"/sdk/init"},kZegoTaskMixStart:{event:"/mix/start_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kTaskIDToLongError:o.errorCodeList.MIXER_TASK_ID_TOO_LONG,kTaskIDInvalidCharacterError:o.errorCodeList.MIXER_TASK_ID_INVALID_CHARACTER,kInputListNullError:o.errorCodeList.MIXER_INPUTLIST_NULL,kOutputListNullError:o.errorCodeList.MIXER_OUTPUTLIST_NULL,kOutputTargetInvalidError:o.errorCodeList.MIXER_OUTPUT_TARGET_INVALID,kOutputNoTargetError:o.errorCodeList.MIXER_NO_OUTPUT_TARGET,kRequestError:o.errorCodeList.MIXER_START_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:o.errorCodeList.NOT_LOGIN},mix_stream_conf:a,stop_reason:function(e){return e}},kZegoTaskMixStop:{event:"/mix/stop_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kTaskIDNullError:o.errorCodeList.MIXER_TASK_ID_NULL,kRequestError:o.errorCodeList.MIXER_STOP_REQUEST_ERROR,kInternalError:o.errorCodeList.MIXER_INNER_ERROR,kNoLoginError:o.errorCodeList.NOT_LOGIN}},kZegoTaskMixConfig:{event:"/mix/config_mix",error:{kParamError:o.errorCodeList.INPUT_PARAM,kVideoConfigInvalidError:o.errorCodeList.MIXER_VIDEO_CONFIG_INVALID,kBackgroundImageUrlInvalidError:o.errorCodeList.MIXER_BACKGROUND_IMAGE_URL_INVALID,kNoLoginError:o.errorCodeList.NOT_LOGIN},mix_params:a}}}},r={};function t(o){var a=r[o];if(void 0!==a)return a.exports;var s=r[o]={exports:{}};return e[o].call(s.exports,s,s.exports,t),s.exports}var o={};return function(){var e=o;Object.defineProperty(e,"__esModule",{value:!0});var r=t(5906);e.default={type:"MixStream",install:function(e,t){for(var o in r.zegoWebRTC)Object.defineProperty(e.prototype,o,{value:r.zegoWebRTC[o],writable:!1});for(var o in r.streamHandler)Object.defineProperty(t.prototype,o,{value:r.streamHandler[o],writable:!1})}}}(),o}()}));