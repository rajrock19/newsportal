!function(e,r){if("object"==typeof exports&&"object"==typeof module)module.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var o=r();for(var t in o)("object"==typeof exports?exports:e)[t]=o[t]}}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";var e={2938:function(e,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.AdvancedModule=void 0;var t=o(4243),s=o(1091),n=o(4427),a=function(){function e(e,r,o,t){this.logger=e,this.dataReport=r,this.streamCenter=o,this.stateCenter=t,this.screenShotReady=!1}return e.prototype.publishTarget=function(e){var r=this,o="";switch(e.type){case"addpush":o=n.ZegoRTCLogEvent.kZegoTaskAddPublishCdnUrl.event;break;case"delpush":case"clearpush":o=n.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.event}var a=this.stateCenter.reporter.createSpan(t.TRACER_LEVEL.H,{key:n.ZegoRTCLogEvent.kZegoTaskPublishStart.event,par:e.streamID},{key:""},o);return a.setAttributes({url:n.ZegoRTCLogEvent.kZegoTaskRemovePublishCdnUrl.url(e.pushUrl)}),new Promise((function(o,t){var i=function(e,o){r.logger.error("zb.pt"+(o||e.message)),r.stateCenter.reporter.setError(a,e,o),t({errorCode:e.code,extendedData:e.message+(o?" "+o:"")})};if(-1==["addpush","delpush","clearpush"].indexOf(e.type))return r.logger.error("zb.sh.pt cdn push type error"),void i(s.errorCodeList.PUBLISHER_CDN_PUSH_ERROR,"type error");if(e.streamID&&"string"==typeof e.streamID)if(e.pushUrl&&"string"==typeof e.pushUrl)if(r.stateCenter.publishStreamList[e.streamID]){var d=r.streamCenter.getRoomByStreamID(e.streamID);if(d){d.streamHandler._publishTarget(e,(function(e){a.end(),o(e)}),i)}else i(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoLoginError)}else i(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kPublishStreamNoFoundError);else i(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"push url error");else i(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kParamError,"stream id type error")}))},e}();r.AdvancedModule=a},4243:function(e,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.streamHandler=r.zegoWebRTC=r.ENUM_PUBLISH_STREAM_STATE=r.ENUM_STREAM_CMD_PRI=r.ENUM_STREAM_SUB_CMD=r.TRACER_LEVEL=r.PROTO_VERSION=void 0;var t,s=o(1091),n=o(4427);r.PROTO_VERSION="2.22.0",function(e){e[e.I=0]="I",e[e.H=10]="H",e[e.M=100]="M",e[e.L=1e3]="L"}(t=r.TRACER_LEVEL||(r.TRACER_LEVEL={})),r.ENUM_STREAM_SUB_CMD={liveNone:0,liveBegin:2001,liveEnd:2002,liveUpdate:2003},r.ENUM_STREAM_CMD_PRI={liveBegin:"zegochat_js.room_stream_create_req",liveEnd:"zegochat_js.room_stream_delete_req",liveUpdate:"zegochat_js.room_stream_update_req"},r.ENUM_PUBLISH_STREAM_STATE={waiting_url:1,tryPublish:2,update_info:3,publishing:4,stop:5,retryPublish:6},r.zegoWebRTC={setStreamExtraInfo:function(e,r){var o=this;return new Promise((function(s,a){var i=o.streamCenter.getRoomByStreamID(e),d=n.ZegoRTCLogEvent.kZegoTaskLiveRoomSendStreamExtraInfo,l=o.stateCenter.reporter.createSpan(t.H,i?{key:n.ZegoRTCLogEvent.kZMLoginRoom.event,par:null==i?void 0:i.roomID}:{key:n.ZegoRTCLogEvent.kZegoTaskInitSetting.event},{key:""},d.event);l.setAttributes({stream_id:d.stream_id(e),stream_extra_info:d.stream_extra_info(r)});var g=function(e,r){o.logger.error("zb.ssei "+r),o.stateCenter.reporter.setError(l,e,r),a({errorCode:e.code,extendedData:e.message+" "+r})};"string"==typeof e&&""!=e?"string"==typeof r&&""!=r?o.RTM.isDisConnect()?g(d.error.kNoLoginError,"not login"):o.stateCenter.publishStreamList[e]?(i=o.streamCenter.getRoomByStreamID(e))?i.streamHandler.setStreamExtraInfo(e,r,(function(e,r){var t,n,i,g;if(0===(null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.err_code)||0===(null==e?void 0:e.errorCode))l.setAttributes({send_seq:d.send_seq(r)}),l.end(),s({errorCode:0===(null===(n=null==e?void 0:e.body)||void 0===n?void 0:n.err_code)?null===(i=null==e?void 0:e.body)||void 0===i?void 0:i.err_code:null==e?void 0:e.errorCode});else{var u={errorCode:(null===(g=null==e?void 0:e.body)||void 0===g?void 0:g.err_code)||(null==e?void 0:e.code)};o.stateCenter.reporter.setError(l,u),a(u)}}),g):g(d.error.kNoLoginError,"not login"):g(d.error.kPublishStreamNoFoundError):g(d.error.kParamError,"extraInfo must be string and no empty"):g(d.error.kParamError,"streamID must be string and not empty")}))}},r.streamHandler={_publishTarget:function(e,o,t){var a=this;this.logger.info("zb.sh.ptcall");var i=Math.ceil((new Date).getTime()/1e3),d=e.streamID;this.stateCenter.testEnvironment&&(d="zegotest-"+this.stateCenter.appid+"-"+e.streamID);var l={appid:this.stateCenter.appid,biz_type:0,timestamp:i,seq:this.stateCenter.cdnSeq++,version:1*r.PROTO_VERSION,stream_id:d,pushurl:e.pushUrl};if(this.logger.debug("zb.sh.pt send command"),this.stateCenter.useNetAgent)this.sendBizChannelRequestV2({server:1,location:"/liveroomcmd/push",cmd:e.type},l,(function(r){a.logger.info("zb.sh.pt receive message");var n=r||{},i=n.code,d=n.message;i&&0!=i?(a.logger.error("zb.sh.pt "+e.type+" error code: "+i+" "+d),t(s.errorCodeList.UNKNOWN_SERVER_ERROR," cmd: ".concat(e.type," ").concat(i," ").concat(d))):(a.logger.info("zb.sh.pt "+e.type+" success"),o&&o({errorCode:0,extendedData:""}))}),(function(r,o,s,i){var d="";i||(i=n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError,200===r?(a.logger.info("zb.sh.pt error: "+o),i=n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError,2001==o?i=n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kInvalidChannelError:2002==o&&(i=n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kBizChannelError),d="cmd: ".concat(e.type,", biz_code: ").concat(o)):d="request media server fail, error: "+r,a.logger.error("zb.sh.pt "+d)),t&&t(i,d)}));else{var g={channel:"media",cmd:e.type,req_body:JSON.stringify(l)};this.sendBizChannelRequest(g,(function(r,i,d){if(a.logger.info("zb.sh.pt receive message"),0!=d.length){var l=JSON.parse(d),g=l.code,u=l.message;g&&0!=g?(a.logger.error("zb.sh.pt "+e.type+" error code: "+g+" "+u),t(s.errorCodeList.UNKNOWN_SERVER_ERROR," cmd: ".concat(e.type," ").concat(g," ").concat(u))):(a.logger.info("zb.sh.pt "+e.type+" success"),o&&o({errorCode:0,extendedData:""}))}else t(n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kNoResponseError)}),(function(r,o,s){a.logger.info("zb.sh.pt error: "+r);var i=n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kUnknownServerError;2001==r?i=n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kInvalidChannelError:2002==r&&(i=n.ZegoRTCLogEvent.kZegoTaskPublishTarget.error.kBizChannelError),a.logger.error("zb.sh.pt "),t(i," cmd: ".concat(e.type," ").concat(r," ").concat("","  "))}))}},updateStreamExtraInfo:function(e,o,t,s){this.logger.info("zb.sh.usei call");var n=r.ENUM_STREAM_SUB_CMD.liveUpdate;this.stateCenter.publishStreamList[e]&&this.stateCenter.publishStreamList[e].state>=r.ENUM_PUBLISH_STREAM_STATE.update_info?(this.stateCenter.publishStreamList[e].extra_info=o,this.updateStreamInfo(e,n,o,t,s)):this.stateCenter.publishStreamList[e]&&this.stateCenter.publishStreamList[e].state===r.ENUM_PUBLISH_STREAM_STATE.tryPublish?(this.stateCenter.publishStreamList[e].extra_info=o,t({errorCode:0})):s(streamExtraInfoKey.error.kUpdateStreamInfoFailError)},setStreamExtraInfo:function(e,r,o,t){this.updateStreamExtraInfo(e,r,o,t)}}},1091:function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.errorCodeList=void 0,r.errorCodeList={NOT_LOGIN:{code:1000002,message:"not login room"},INPUT_PARAM:{code:1100001,message:"input param error."},PUBLISH_NOT_PUBLISH:{code:1103040,message:"publisher not found"},PUBLISH_NO_PREVIEW:{code:1103044,message:"stream is not from zego"},TRACK_NOT_FOUND:{code:1103047,message:"track is not found"},DEVICE_NOT_FOUND:{code:1103048,message:"device is not found"},PUBLISHER_CONSTRAINTS_ERROR:{code:1103029,message:"constraint error"},PUBLISHER_CDN_PUSH_ERROR:{code:1103052,message:"publisher cdn push error"},VIDEO_DEVICE_FALSE:{code:1103045,message:"video is false"},AUDIO_DEVICE_FALSE:{code:1103046,message:"audio is false"},UNKNOWN_SERVER_ERROR:{code:1100999,message:"unknown server error"},LOCALSTREAM_WRONG:{code:1000018,message:"local stream wrong"},PUBLISHER_STREAM_NO_FOUND:{code:1103055,message:"publish stream no found"},PUBLISH_TARGET_NO_RESPONSE:{code:1103063,message:"publish target no response"},BIZ_CHANNEL_ERROR:{code:1102021,message:"biz channel error."},INVALID_CHANNEL:{code:1102024,message:"invalid channel"},PUBLISHER_EXTRA_INFO_NULL:{code:1003050,message:"extra info of publishing stream is null"},PUBLISHER_UPDATE_STREAM_INFO_FAIL:{code:1103062,message:"update stream info fail"},TRACK_CAN_NOT_ADD:{code:1103063,message:"only stream which have one track and kind no exist can add track"},TRACK_CAN_NOT_REMOVE:{code:1103064,message:"stream which only has one track can not remove "},PUBLISHER_UPDATE_SDP_FAIL:{code:1103068,message:"update sdp fail"},PUBLISHER_STATE_WRONG:{code:1103069,message:"publisher state wrong"},HANDLE_TRACK_NOT_SUPPORTED:{code:1103070,message:"not support remove track"},VIDEO_EFFECT_IS_RUNNING:{code:1103071,message:"video effect processor is running"}}},4427:function(e,r,o){Object.defineProperty(r,"__esModule",{value:!0}),r.ZegoRTCLogEvent=void 0;var t=o(1091),s=function(e){return e};r.ZegoRTCLogEvent={kZegoTaskInitSetting:{event:"/sdk/init"},kZMLoginRoom:{event:"/sdk/login"},kZegoTaskPublishStart:{event:"/sdk/start_publish"},kZegoTaskPublishTarget:{event:"/sdk/publish_target",error:{kParamError:t.errorCodeList.INPUT_PARAM,kPublishStreamNoFoundError:t.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kNoLoginError:t.errorCodeList.NOT_LOGIN,kNoResponseError:t.errorCodeList.PUBLISH_TARGET_NO_RESPONSE,kBizChannelError:t.errorCodeList.BIZ_CHANNEL_ERROR,kInvalidChannelError:t.errorCodeList.INVALID_CHANNEL,kUnknownServerError:t.errorCodeList.UNKNOWN_SERVER_ERROR}},kZegoTaskAddPublishCdnUrl:{event:"/mss/pushadd",error:{kParamError:t.errorCodeList.INPUT_PARAM},stream_id:s,url:s},kZegoTaskRemovePublishCdnUrl:{event:"/mss/pushdel",error:{kParamError:t.errorCodeList.INPUT_PARAM},stream_id:s,url:s},kZegoTaskClearPublishCdnUrl:{event:"/sdk/clear_publish_cdn_url",error:{kParamError:t.errorCodeList.INPUT_PARAM}},kZegoTaskLiveRoomSendStreamExtraInfo:{event:"/liveroom/send_stream_extra_info",error:{kParamError:t.errorCodeList.INPUT_PARAM,kExtraInfoNullError:t.errorCodeList.PUBLISHER_EXTRA_INFO_NULL,kNoLoginError:t.errorCodeList.NOT_LOGIN,kPublishStreamNoFoundError:t.errorCodeList.PUBLISHER_STREAM_NO_FOUND,kUpdateStreamInfoFailError:t.errorCodeList.PUBLISHER_UPDATE_STREAM_INFO_FAIL},stream_id:s,stream_extra_info:s,room_sid_string:s,room_id:s,send_seq:function(e){return e}}}}},r={};function o(t){var s=r[t];if(void 0!==s)return s.exports;var n=r[t]={exports:{}};return e[t](n,n.exports,o),n.exports}var t={};return function(){var e=t;Object.defineProperty(e,"__esModule",{value:!0});var r=o(2938),s=o(4243);e.default={type:"StreamCommon",install:function(e,o,t){for(var n in Object.defineProperty(o.prototype,"initStreamCommon",{value:function(){this.streamCommonModule=new r.AdvancedModule(this.logger,this.dataReport,this.streamCenter,this.stateCenter)},writable:!1}),s.zegoWebRTC)Object.defineProperty(e.prototype,n,{value:s.zegoWebRTC[n],writable:!1});for(var n in s.streamHandler)Object.defineProperty(t.prototype,n,{value:s.streamHandler[n],writable:!1})}}}(),t}()}));